{% extends 'base.html' %}
{% load static %}
{% load pa_bonus_extras %}

{% block title %}C√≠lov√© bonusy{% endblock %}

{% block content %}
<div class="extra-goals-container">
    <h1>C√≠lov√© bonusy</h1>
    
    {% if error %}
        <div class="no-contract-message">
            <p>{{ error }}</p>
        </div>
    {% elif not goals %}
        <div class="no-goals-message">
            <p>Pro va≈°i smlouvu nejsou aktu√°lnƒõ nastaveny ≈æ√°dn√© c√≠lov√© bonusy.</p>
            <p>V p≈ô√≠padƒõ dotaz≈Ø kontaktujte sv√©ho obchodn√≠ho z√°stupce.</p>
        </div>
    {% else %}
        <div class="goals-intro">
            <p>Zde m≈Ø≈æete sledovat plnƒõn√≠ va≈°ich c√≠lov√Ωch bonus≈Ø. Za p≈ôekroƒçen√≠ stanoven√Ωch c√≠l≈Ø z√≠sk√°v√°te bonusov√© body nav√≠c.</p>
        </div>
        
        {% for goal_data in goals %}
        <div class="goal-card">
            <div class="goal-header">
                <h2>C√≠lov√Ω bonus ƒç. {{ forloop.counter }}</h2>
                <div class="goal-period">
                    {{ goal_data.goal.goal_period_from|date:"d.m.Y" }} - {{ goal_data.goal.goal_period_to|date:"d.m.Y" }}
                </div>
            </div>
            
            <div class="goal-brands">
                <strong>Znaƒçky:</strong>
                {% for brand in goal_data.brands %}
                    <span class="brand-badge">{{ brand.name }}</span>
                {% endfor %}
            </div>
            
            <div class="goal-summary">
                <div class="summary-item">
                    <span class="summary-label">Celkov√Ω c√≠l:</span>
                    <span class="summary-value">{{ goal_data.goal.goal_value|floatformat:0 }} Kƒç</span>
                </div>
                <div class="summary-item">
                    <span class="summary-label">Aktu√°ln√≠ obrat:</span>
                    <span class="summary-value">{{ goal_data.total_actual|floatformat:0 }} Kƒç</span>
                </div>
                <div class="summary-item">
                    <span class="summary-label">Celkem splnƒõno:</span>
                    <div class="progress-bar-container">
                        <div class="progress-bar" style="width: {{ goal_data.total_progress|floatformat:0 }}%">
                            <span class="progress-text">{{ goal_data.total_progress|floatformat:0 }}%</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="evaluation-periods">
                <h3>Hodnocen√° obdob√≠</h3>
                <div class="periods-grid">
                    {% for period in goal_data.periods %}
                    <div class="period-card {% if period.is_current %}current-period{% endif %} status-{{ period.status }}">
                        <div class="period-header">
                            <span class="period-dates">
                                {{ period.start|date:"d.m.Y" }} - {{ period.end|date:"d.m.Y" }}
                            </span>
                            {% if period.is_current %}
                                <span class="current-badge">Aktu√°ln√≠</span>
                            {% endif %}
                        </div>
                        
                        <div class="period-status">
                            {% if period.status == 'achieved' %}
                                <span class="status-indicator achieved">‚úì Splnƒõno</span>
                            {% elif period.status == 'failed' %}
                                <span class="status-indicator failed">‚úó Nesplnƒõno</span>
                            {% elif period.status == 'pending_evaluation' %}
                                <span class="status-indicator pending">‚è≥ ƒåek√° na vyhodnocen√≠</span>
                            {% elif period.status == 'in_progress' %}
                                <span class="status-indicator progress">‚ö° Prob√≠h√°</span>
                            {% else %}
                                <span class="status-indicator future">üóì Budouc√≠</span>
                            {% endif %}
                        </div>
                        
                        <div class="period-details">
                            <div class="detail-row">
                                <span>C√≠l obdob√≠:</span>
                                <span>{{ period.target|floatformat:0 }} Kƒç</span>
                            </div>
                            <div class="detail-row">
                                <span>Aktu√°ln√≠ obrat:</span>
                                <span>{{ period.actual|floatformat:0 }} Kƒç</span>
                            </div>
                            {% if period.status != 'future' %}
                            <div class="detail-row">
                                <span>Splnƒõno:</span>
                                <div class="mini-progress-bar">
                                    <div class="mini-progress-fill" style="width: {{ period.progress|floatformat:0 }}%"></div>
                                </div>
                                <span>{{ period.progress|floatformat:0 }}%</span>
                            </div>
                            {% endif %}
                            {% if period.bonus_points > 0 %}
                            <div class="detail-row bonus-points">
                                <span>Bonusov√© body:</span>
                                <span class="points-value">+{{ period.bonus_points }}</span>
                            </div>
                            {% endif %}
                        </div>
                    </div>
                    {% endfor %}
                </div>
            </div>
            
            {% if goal_data.goal.allow_full_period_recovery %}
            <div class="recovery-note">
                <p><strong>Pozn√°mka:</strong> Pokud nespln√≠te d√≠lƒç√≠ c√≠le, ale spln√≠te celkov√Ω c√≠l za cel√© obdob√≠, z√≠sk√°te zpƒõtnƒõ bonusov√© body za cel√© obdob√≠.</p>
            </div>
            {% endif %}
        </div>
        {% endfor %}
    {% endif %}
</div>
{% endblock %}